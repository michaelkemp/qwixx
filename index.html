<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>QWIXX</title>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <div>
      <table>
        <tr id="redrow" class="checks">
          <td id="red0">2</td>
          <td id="red1">3</td>
          <td id="red2">4</td>
          <td id="red3">5</td>
          <td id="red4">6</td>
          <td id="red5">7</td>
          <td id="red6">8</td>
          <td id="red7">9</td>
          <td id="red8">10</td>
          <td id="red9">11</td>
          <td id="red10">12</td>
          <td id="red11"><i class="fa-solid fa-lock"></i></td>
        </tr>
        <tr id="yelrow" class="checks">
          <td id="yel0">2</td>
          <td id="yel1">3</td>
          <td id="yel2">4</td>
          <td id="yel3">5</td>
          <td id="yel4">6</td>
          <td id="yel5">7</td>
          <td id="yel6">8</td>
          <td id="yel7">9</td>
          <td id="yel8">10</td>
          <td id="yel9">11</td>
          <td id="yel10">12</td>
          <td id="yel11"><i class="fa-solid fa-lock"></i></td>
        </tr>
        <tr id="grnrow" class="checks">
          <td id="grn0">12</td>
          <td id="grn1">11</td>
          <td id="grn2">10</td>
          <td id="grn3">9</td>
          <td id="grn4">8</td>
          <td id="grn5">7</td>
          <td id="grn6">6</td>
          <td id="grn7">5</td>
          <td id="grn8">4</td>
          <td id="grn9">3</td>
          <td id="grn10">2</td>
          <td id="grn11"><i class="fa-solid fa-lock"></i></td>
        </tr>
        <tr id="blurow" class="checks">
          <td id="blu0">12</td>
          <td id="blu1">11</td>
          <td id="blu2">10</td>
          <td id="blu3">9</td>
          <td id="blu4">8</td>
          <td id="blu5">7</td>
          <td id="blu6">6</td>
          <td id="blu7">5</td>
          <td id="blu8">4</td>
          <td id="blu9">3</td>
          <td id="blu10">2</td>
          <td id="blu11"><i class="fa-solid fa-lock"></i></td>
        </tr>
      </table>

      <table>
        <tr id="stkrow" class="stks">
          <td id="stk0"><i class="fa-solid fa-dice"></i></td>
          <td id="stk1"><i class="fa-solid fa-dice"></i></td>
          <td id="stk2"><i class="fa-solid fa-dice"></i></td>
          <td id="stk3"><i class="fa-solid fa-dice"></i></td>
        </tr>
      </table>

      <table>
        <tr class="scores">
          <td class="score" id="scred">0</td>
          <td class="score" id="scyel">0</td>
          <td class="score" id="scgrn">0</td>
          <td class="score" id="scblu">0</td>
          <td class="score" id="scstk">0</td>
          <td class="score" id="sctot">0</td>
        </tr>
      </table>

      <table class="dicetable">
        <tr class="dice" id="roll">
          <td id="di1" class="d1"></td>
          <td id="di2" class="d2"></td>
          <td id="dir" class="d3"></td>
          <td id="diy" class="d4"></td>
          <td id="dig" class="d5"></td>
          <td id="dib" class="d6"></td>
        </tr>
      </table>
    </div>

	<script>
    (function () {
      const lo = ["2","3","4","5","6","7","8","9","10","11","12",'<i class="fa-solid fa-lock"></i>'];
      const hi = ["12","11","10","9","8","7","6","5","4","3","2",'<i class="fa-solid fa-lock"></i>'];
      const scr = [0,1,3,6,10,15,21,28,36,45,55,66,78];
      let red = [0,0,0,0,0,0,0,0,0,0,0,0];
      let yel = [0,0,0,0,0,0,0,0,0,0,0,0];
      let grn = [0,0,0,0,0,0,0,0,0,0,0,0];
      let blu = [0,0,0,0,0,0,0,0,0,0,0,0];
      let stk = [0,0,0,0];

      roll.addEventListener('click', function(){ 
        for(let i=0; i<24; ++i) {
          setTimeout(function() {
            let di1 = Math.floor(Math.random() * 6) + 1;
            let di2 = Math.floor(Math.random() * 6) + 1;
            let dir = Math.floor(Math.random() * 6) + 1;
            let diy = Math.floor(Math.random() * 6) + 1;
            let dig = Math.floor(Math.random() * 6) + 1;
            let dib = Math.floor(Math.random() * 6) + 1;
            document.getElementById("di1").className = "d"+di1;
            document.getElementById("di2").className = "d"+di2;
            document.getElementById("dir").className = "d"+dir;
            document.getElementById("diy").className = "d"+diy;
            document.getElementById("dig").className = "d"+dig;
            document.getElementById("dib").className = "d"+dib;
          }, 50*i);
        }
      });

      for(let i=0; i<4; ++i) {
        let stkEl = document.getElementById("stk"+i);
        stkEl.addEventListener('click', function(){ 
            if (this.innerHTML == '<i class="fa-solid fa-dice"></i>') {
              this.innerHTML = '<i class="fa-solid fa-x"></i>';
              stk[i] = 1;
            } else {
              this.innerHTML = '<i class="fa-solid fa-dice"></i>';
              stk[i] = 0;
            }
            score();
        });
      }

      function score() {
        let r = 0;
        let y = 0;
        let g = 0;
        let b = 0;
        let s = 0;
        for(let i=0; i<4; ++i) {
          s+= stk[i];
        }
        for(let i=0;i<10;++i) {
          r += red[i];
          y += yel[i];
          g += grn[i];
          b += blu[i];
        }
        if ((red[10] == 1) && (red[11] == 1)) { r += 2; }
        if ((yel[10] == 1) && (yel[11] == 1)) { y += 2; }
        if ((grn[10] == 1) && (grn[11] == 1)) { g += 2; }
        if ((blu[10] == 1) && (blu[11] == 1)) { b += 2; }
        let tr = scr[r];
        let ty = scr[y];
        let tg = scr[g];
        let tb = scr[b];
        let ts = s * -5;
        let tot = tr + ty + tg + tb + ts;
        let sred = document.getElementById("scred");
        let syel = document.getElementById("scyel");
        let sgrn = document.getElementById("scgrn");
        let sblu = document.getElementById("scblu");
        let sstk = document.getElementById("scstk");
        let stot = document.getElementById("sctot");
        sred.innerHTML=tr;
        syel.innerHTML=ty;
        sgrn.innerHTML=tg;
        sblu.innerHTML=tb;
        sstk.innerHTML=ts;
        stot.innerHTML=tot;
      }

      function can(arr, num) {
        // if locked return false
        if ((num != 11) && (arr[11] == 1)) {
          return 0;
        }
        // only if they have 5 others checked
        if (num == 10) {
          let cnt = 0;
          for(let i=0; i<10; ++i) {
            cnt += arr[i];
          }
          if (cnt < 5) {
            return 0;
          }
          return 1;
        }
        // cant check earlier number
        let later = 0;
        for(let i=11; i>num; --i) {
          later += arr[i];
        }
        if (later == 0) {
          return 1;
        }
        return 0;
      }

      function listen2me(element, hilo, col, num) {
        if (element.innerHTML == hilo[num]) {
          if (can(col,num)) {
            element.innerHTML = '<i class="fa-solid fa-x"></i>';
            col[num] = 1;
          }
        } else {
          if ((num == 11) || (col[11] == 0)) { // not locked
            element.innerHTML = hilo[num];
            col[num] = 0;
          }
        }
        score();
      }

      for(let i=0; i<12; ++i) { 
        let redEl = document.getElementById("red"+i);
        let yelEl = document.getElementById("yel"+i);
        let grnEl = document.getElementById("grn"+i);
        let bluEl = document.getElementById("blu"+i);
        redEl.addEventListener('click', function(){ 
          listen2me(redEl, lo, red, i);
        });
        yelEl.addEventListener('click', function(){ 
          listen2me(yelEl, lo, yel, i);
        });
        grnEl.addEventListener('click', function(){ 
          listen2me(grnEl, hi, grn, i);
        });
        bluEl.addEventListener('click', function(){ 
          listen2me(bluEl, hi, blu, i);
        });
      }

    })();
  </script>
  </body>
</html>

